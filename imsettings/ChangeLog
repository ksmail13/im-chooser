2008-02-08  Akira TAGOH  <tagoh@redhat.com>

	* backends/gconf/main.c (imsettings_gconf_message_filter): add actions
	for org.freedesktop.DBus.Local.Disconnected and
	org.freedesktop.DBus.NameOwnerChanged.

	* src/factory.c (main): get rid of sending a reload request.
	(main): connect to the disconnect signal.

	* src/factory_info.c (main): get rid of sending a reload request.
	(main): connect to the disconnect signal.

	* src/imsettings-manager.c (imsettings_manager_real_finalize):
	unref a connection for requesting.
	(imsettings_manager_real_start_im): likewise.
	(imsettings_manager_real_stop_im): likewise.

	* imsettings/imsettings-observer.c (imsettings_observer_signal_disconnected):
	new function to handle org.freedesktop.DBus.Local.Disconnected.
	(imsettings_observer_signal_name_owner_changed): new function to handle
	org.freedesktop.DBus.NameOwnerChanged.
	(imsettings_observer_class_init): add a disconnected signal.

	* imsettings/imsettings-utils.c: cleaning up.

	* utils/imsettings-list.c (main): unref a connection.

	* utils/imsettings-reload.c (main): likewise.

	* utils/imsettings-stop.c (main): likewise.

	* utils/imsettings-restart.c (main): likewise.

	* utils/imsettings-start.c (main): likewise.

	* utils/imsettings-info.c (main): likewise.

2008-02-07  Akira TAGOH  <tagoh@redhat.com>

	* src/imsettings-manager.c: cleaning up.

	* imsettings/imsettings-request.c: cleaning up.

	* imsettings/imsettings-observer.c: cleaning up.

	* imsettings/imsettings-info.c: cleaning up.

	* src/imsettings-manager.c (_build_pidfilename): get rid of .bak from
	the filename to make stopping-process working for the user specific
	xinputrc.
	(_update_symlink): do nothing if it's going to do something for .xinputrc.
	(imsettings_manager_load_conf): add the info for .xinputrc.bak too.

	* imsettings/imsettings-info.c (imsettings_info_set_property):
	Set properties for the user specific xinputrc too. (RH#431291)

2008-01-30  Akira TAGOH  <tagoh@redhat.com>

	* src/imsettings-manager.c (_start_process): set an empty string
	if args is null.
	(imsettings_manager_real_start_im): reload the IM info.
	(imsettings_manager_real_stop_im): likewise.

	* imsettings/imsettings-request.c (imsettings_request_set_property):
	remove the code to unref the dbus connection so far.
	(imsettings_request_finalize): likewise.

	* imsettings/imsettings-observer.c (imsettings_observer_set_property):
	remove the code to unref the dbus connection so far.
	(imsettings_observer_finalize): likewise.

2008-01-28  Akira TAGOH  <tagoh@redhat.com>

	* src/imsettings-manager.c (_update_symlink): check the filename.
	we don't expect the filename is NULL for the user specific conffile anymore.

	* imsettings/imsettings-info-private.h (IMSETTINGS_USER_SPECIFIC_SHORT_DESC):
	Fix a typo.

	* imsettings/imsettings-info.c (imsettings_info_set_property):
	check the filename much strictly.

2008-01-25  Akira TAGOH  <tagoh@redhat.com>

	* backends/gconf/Makefile.am (EXTRA_DIST): Fix a typo.

	* src/imsettings-manager.c (_start_process): Inherit the environment
	variables to bring up the child process.

	* src/imsettings-manager.c (_collect_im_list): new.
	(imsettings_manager_real_get_list): build the IM list dynamically.
	(_start_process): set LC_CTYPE to run the programs.

	* imsettings/imsettings-request.c (imsettings_request_set_locale): new.
	(imsettings_request_is_system_default): new.
	(imsettings_request_is_user_default): new.
	(imsettings_request_is_xim): new.
	(imsettings_request_get_supported_language): new.

	* imsettings/imsettings-observer.c (imsettings_is_system_default): new.
	(imsettings_is_user_default): new.
	(imsettings_is_xim): new.
	(imsettings_get_supported_language): new.

	* imsettings/imsettings.xml (IsSystemDefault): new.
	(IsUserDefault): new.
	(IsXim): new.
	(GetList): Add lang argument.
	(StartIM): likewise.

	* imsettings/imsettings-info.c (imsettings_info_notify_properties):
	Fetch the informations from xinputinfo.sh instead of xinput.sh with some options.
	(imsettings_info_set_property): Update the information against the locale.
	(imsettings_info_set_property): always set XIM is visible no matter
	what the status is, except the dead link.
	(imsettings_info_new_with_lang): new.
	(imsettings_info_is_xim): new.

	* utils/imsettings-list.c (main): Get a different output against current locale.

	* utils/imsettings-info.c (main): likewise.

	* utils/imsettings-start.c (main): likewise.

2008-01-24  Akira TAGOH  <tagoh@redhat.com>

	* src/imsettings-manager.c (_start_process): Fix a silly bug that
	always create a pidfile no matter what the file exists.
	(_start_process): do nothing if the program name is an empty.
	(_stop_process): new.
	(_update_symlink): new.
	(imsettings_manager_real_start_im): Update .xinputrc.
	(imsettings_manager_real_stop_im): Implement a lot.

	* imsettings/imsettings.xml (StopIM): Add a boolean for force flag.

	* imsettings/marshal.list: new.

	* imsettings/imsettings-info.c (imsettings_info_set_property):
	do not set an empty string to the property.
	(imsettings_info_set_property): turn on an ignore property
	if the conf file is invalid.

	* utils/imsettings-restart.c (main): Add --force option to stop IM
	forcibly.

	* utils/imsettings-stop.c (main): likewise.

2008-01-24  Akira TAGOH  <tagoh@redhat.com>

	* src/imsettings-manager.c (imsettings_manager_load_conf): Make
	a condition to not segfault. user's .xinputrc is more likely to be
	unavailable.

	* imsettings/imsettings-info.c (imsettings_info_is_visible):
	Fix a reverse flag.

2008-01-23  Akira TAGOH  <tagoh@redhat.com>

	* src/factory.c (main): Update to get a X display name.

	* src/imsettings-manager.c (imsettings_manager_real_set_property): new.
	(imsettings_manager_real_get_property): new.
	(_remove_pidfile): new.
	(_start_process): new.
	(_build_pidfilename): new.
	(imsettings_manager_real_start_im): Add an implementation to bring up
	an auxiliary program and XIM server.

	* imsettings/imsettings-request.c (imsettings_request_get_xim_program):
	new function.

	* imsettings/imsettings-observer.c (imsettings_get_xim_program): add
	a callback to deal with GetXimProgram method.

	* imsettings/imsettings.xml: add GetXimProgram method.

	* imsettings/imsettings-info.c (imsettings_info_get_xim_program): new.
	(imsettings_info_get_xim_args): new.

	* utils/imsettings-info.c (main): output XIM server's configuration too.

2008-01-22  Akira TAGOH  <tagoh@redhat.com>

	* Initial commit for imsettings library.
